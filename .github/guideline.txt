=========================================================
GUIDELINE TRI·ªÇN KHAI ƒê·ªÄ T√ÄI 13 (B·∫£n n√¢ng cao)
H·ªá th·ªëng Video Streaming, AI Filters v√† T∆∞∆°ng t√°c Real-time
Ki·∫øn tr√∫c: Microservices (4 Services) + Frontend Next.js
=========================================================

### M·ª§C TI√äU N√ÇNG C·∫§P (ADVANCED FEATURES)

1.  **Giao di·ªán hi·ªán ƒë·∫°i:** S·ª≠ d·ª•ng `shadcn/ui` v√† `TailwindCSS` cho UI/UX.
2.  **N·ªÅn ·∫£o (Virtual Backgrounds):** Cho ph√©p ng∆∞·ªùi d√πng l√†m m·ªù ho·∫∑c thay th·∫ø n·ªÅn (Blur/Image Background).
3.  **T∆∞∆°ng t√°c AI (Gestures):** Nh·∫≠n di·ªán c·ª≠ ch·ªâ tay (v√≠ d·ª•: gi∆° tay) ƒë·ªÉ th·ª±c hi·ªán h√†nh ƒë·ªông.
4.  **Filter 3D (AR Filters):** √Åp d·ª•ng c√°c v·∫≠t th·ªÉ 3D (k√≠nh, m≈©) l√™n m·∫∑t ng∆∞·ªùi d√πng v√† xoay theo g√≥c nh√¨n.
5.  **T∆∞∆°ng t√°c trong ph√≤ng:** Chat text real-time v√† th·∫£ Reactions (üëç, ‚ù§Ô∏è) bay l√™n m√†n h√¨nh.
6.  **T√≠nh nƒÉng Web API:** Screen Sharing (chia s·∫ª m√†n h√¨nh) v√† Client-side Recording (quay video cu·ªôc g·ªçi).
7.  **Qu·∫£n l√Ω ng∆∞·ªùi d√πng:** H·ªó tr·ª£ ƒêƒÉng k√Ω/ƒêƒÉng nh·∫≠p v√† t·∫°o "Ph√≤ng c·ªë ƒë·ªãnh" (Persistent Rooms).
8.  **Tr·∫£i nghi·ªám ·ª©ng d·ª•ng:** T·ªëi ∆∞u th√†nh Progressive Web App (PWA) c√≥ th·ªÉ "c√†i ƒë·∫∑t".

---

### SERVICE 1: FRONTEND & CORE AI LOGIC (Person 1)

* **C√¥ng ngh·ªá ch√≠nh:** Next.js (React), shadcn/ui, TailwindCSS, Framer Motion, TensorFlow.js (@mediapipe), OpenCV.js, Three.js, Socket.IO-Client, WebRTC, next-pwa.
* **M√¥ t·∫£:** Tr√°i tim c·ªßa ·ª©ng d·ª•ng, x·ª≠ l√Ω to√†n b·ªô UI/UX v√† logic AI/Filter n·∫∑ng ph√≠a client.
* **Nhi·ªám v·ª• chi ti·∫øt:**
    1.  **X√¢y d·ª±ng Giao di·ªán (UI/UX):**
        * D·ª±ng to√†n b·ªô UI (Landing Page, Room Page) b·∫±ng c√°c components t·ª´ **shadcn/ui** (Button, Input, Dialog, Tooltip, Avatar...).
        * S·ª≠ d·ª•ng **TailwindCSS** ƒë·ªÉ t√πy ch·ªânh thi·∫øt k·∫ø.
        * D√πng **Framer Motion** ƒë·ªÉ th√™m c√°c hi·ªáu ·ª©ng chuy·ªÉn ƒë·ªông (animations) m∆∞·ª£t m√†.
    2.  **Thi·∫øt l·∫≠p Pipeline X·ª≠ l√Ω Video (Core Logic):**
        * L·∫•y stream t·ª´ camera (`getUserMedia`) ho·∫∑c m√†n h√¨nh (`getDisplayMedia`).
        * Thi·∫øt l·∫≠p v√≤ng l·∫∑p `requestAnimationFrame` v√† `Canvas` ƒë·ªÉ x·ª≠ l√Ω frame-by-frame.
        * **T√≠ch h·ª£p AI - Virtual Background:** D√πng TensorFlow.js + model `MediaPipe Selfie Segmentation` ƒë·ªÉ t√°ch ng∆∞·ªùi ra kh·ªèi n·ªÅn -> v·∫Ω l·∫°i l√™n canvas v·ªõi n·ªÅn m·ªù ho·∫∑c n·ªÅn t√πy ch·ªânh.
        * **T√≠ch h·ª£p AI - 3D AR Filters:** D√πng model `MediaPipe Face Mesh` (l·∫•y l∆∞·ªõi 3D c·ªßa m·∫∑t) k·∫øt h·ª£p `Three.js` ƒë·ªÉ render c√°c v·∫≠t th·ªÉ 3D (m≈©, k√≠nh) kh·ªõp v·ªõi khu√¥n m·∫∑t.
        * **T√≠ch h·ª£p AI - Gesture Recognition:** D√πng model `MediaPipe Hands` ƒë·ªÉ ph√°t hi·ªán c·ª≠ ch·ªâ (v√≠ d·ª•: gi∆° tay), sau ƒë√≥ g·ª≠i s·ª± ki·ªán qua Socket.IO.
    3.  **T√≠ch h·ª£p T√≠nh nƒÉng Web API:**
        * **Screen Sharing:** Tri·ªÉn khai logic cho `getDisplayMedia`.
        * **Client-side Recording:** D√πng **`MediaRecorder` API** ƒë·ªÉ ghi l·∫°i `canvas.captureStream()` v√† cho ph√©p ng∆∞·ªùi d√πng download file video.
        * **PWA:** C·∫•u h√¨nh `next-pwa` ƒë·ªÉ t·∫°o Service Worker v√† Web App Manifest, cho ph√©p "C√†i ƒë·∫∑t" ·ª©ng d·ª•ng.
    4.  **Logic WebRTC & T∆∞∆°ng t√°c:**
        * L·∫•y stream ƒë√£ x·ª≠ l√Ω (t·ª´ Canvas) ƒë∆∞a v√†o `RTCPeerConnection`.
        * G·ªçi **Service 2** ƒë·ªÉ ƒëƒÉng nh·∫≠p, t·∫°o/l·∫•y ph√≤ng.
        * K·∫øt n·ªëi **Service 3** ƒë·ªÉ x·ª≠ l√Ω t√≠n hi·ªáu WebRTC (offer, answer...) V√Ä g·ª≠i/nh·∫≠n tin nh·∫Øn chat, reactions.
        * C·∫•u h√¨nh **Service 4** (STUN/TURN) cho `RTCPeerConnection`.

---

### SERVICE 2: API QU·∫¢N L√ù USER & PH√íNG (API Service) (Person 2)

* **C√¥ng ngh·ªá ch√≠nh:** Node.js (Express/Fastify), REST API, Database (PostgreSQL/MongoDB), JWT (JSON Web Tokens), Prisma (ho·∫∑c ORM kh√°c).
* **M√¥ t·∫£:** Microservice backend qu·∫£n l√Ω tr·∫°ng th√°i, user v√† ph√≤ng ·ªëc.
* **Nhi·ªám v·ª• chi ti·∫øt:**
    1.  **Thi·∫øt k·∫ø Database:**
        * Schema cho `Users` (email, password hashed, name...).
        * Schema cho `Rooms` (room_id, t√™n ph√≤ng, `ownerId` (kh√≥a ngo·∫°i t·ªõi Users), slug (cho ƒë∆∞·ªùng d·∫´n ƒë·∫πp)).
    2.  **X√¢y d·ª±ng Authentication API (D√πng JWT):**
        * `POST /api/auth/register`
        * `POST /api/auth/login`
        * `GET /api/auth/me` (L·∫•y th√¥ng tin user hi·ªán t·∫°i t·ª´ Token)
    3.  **X√¢y d·ª±ng Room API (Y√™u c·∫ßu x√°c th·ª±c):**
        * `POST /api/rooms/create`: T·∫°o ph√≤ng ng·∫´u nhi√™n (cho kh√°ch).
        * `POST /api/rooms/persistent`: T·∫°o ph√≤ng c·ªë ƒë·ªãnh (cho user ƒë√£ ƒëƒÉng nh·∫≠p), v√≠ d·ª•: `/room/my-team`.
        * `GET /api/rooms/user`: L·∫•y danh s√°ch c√°c ph√≤ng c·ªßa user.
        * `GET /api/rooms/:roomId`: L·∫•y th√¥ng tin/ki·ªÉm tra ph√≤ng t·ªìn t·∫°i.
    4.  **Dockerfile:** Vi·∫øt Dockerfile ƒë·ªÉ ƒë√≥ng g√≥i service.
* **Giao th·ª©c th·ªëng nh·∫•t (Interface):** Cung c·∫•p t√†i li·ªáu API (Swagger/OpenAPI) cho Person 1.

---

### SERVICE 3: M√ÅY CH·ª¶ T√çN HI·ªÜU & T∆Ø∆†NG T√ÅC (Signaling Server) (Person 3)

* **C√¥ng ngh·ªá ch√≠nh:** Node.js + WebSockets (∆∞u ti√™n `Socket.IO`).
* **M√¥ t·∫£:** D·ªãch v·ª• "mai m·ªëi" (Signaling) cho WebRTC v√† trung chuy·ªÉn tin nh·∫Øn, s·ª± ki·ªán real-time.
* **Nhi·ªám v·ª• chi ti·∫øt:**
    1.  **X√¢y d·ª±ng WebSocket Server (Socket.IO):**
    2.  **Qu·∫£n l√Ω Room v√† Socket:**
        * Cho ph√©p client `join_room` v√† `leave_room`.
    3.  **L·∫Øng nghe v√† Chuy·ªÉn ti·∫øp (Broadcast) c√°c s·ª± ki·ªán WebRTC (c·ªët l√µi):**
        * `offer`, `answer`, `ice_candidate`.
    4.  **L·∫Øng nghe v√† Chuy·ªÉn ti·∫øp c√°c s·ª± ki·ªán T∆∞∆°ng t√°c (N√¢ng cao):**
        * `send_message`: Nh·∫≠n tin nh·∫Øn chat t·ª´ 1 client v√† broadcast cho c·∫£ ph√≤ng.
        * `send_reaction`: Nh·∫≠n s·ª± ki·ªán "th·∫£ tim" v√† broadcast cho c·∫£ ph√≤ng.
        * `send_gesture`: Nh·∫≠n s·ª± ki·ªán "gi∆° tay" v√† broadcast.
    5.  **Dockerfile:** Vi·∫øt Dockerfile ƒë·ªÉ ƒë√≥ng g√≥i service.
* **Giao th·ª©c th·ªëng nh·∫•t (Interface):** ƒê·ªãnh nghƒ©a r√µ t√™n t·∫•t c·∫£ c√°c s·ª± ki·ªán Socket (v√≠ d·ª•: `join_room`, `send_message`, `new_message`...) cho Person 1.

---

### SERVICE 4: M√ÅY CH·ª¶ STUN/TURN (NAT Traversal) (Person 4)

* **C√¥ng ngh·ªá ch√≠nh:** Docker, COTURN.
* **M√¥ t·∫£:** Service h·∫° t·∫ßng gi√∫p WebRTC v∆∞·ª£t qua c√°c l·ªõp t∆∞·ªùng l·ª≠a (NAT).
* **Nhi·ªám v·ª• chi ti·∫øt (Thi√™n v·ªÅ DevOps):**
    1.  **Nghi√™n c·ª©u STUN/TURN:**
        * **STUN:** Gi√∫p client bi·∫øt IP public.
        * **TURN:** L√†m server trung gian (relay) khi k·∫øt n·ªëi P2P (tr·ª±c ti·∫øp) th·∫•t b·∫°i.
    2.  **Tri·ªÉn khai COTURN:**
        * T√¨m Docker Image c·ªßa COTURN (v√≠ d·ª•: `coturn/coturn`).
        * Vi·∫øt file c·∫•u h√¨nh `turnserver.conf` (ƒë·ªãnh nghƒ©a port, realm, user/password cho TURN).
    3.  **T√≠ch h·ª£p Docker Compose:**
        * Th√™m service `coturn` v√†o file `docker-compose.yml` chung.
        * Map file `turnserver.conf` v√†o container.
        * M·ªü c√°c port c·∫ßn thi·∫øt (v√≠ d·ª•: `3478/tcp` v√† `3478/udp`).
* **Giao th·ª©c th·ªëng nh·∫•t (Interface):** Cung c·∫•p th√¥ng tin c·∫•u h√¨nh (URL, username, password) c·ªßa m√°y ch·ªß STUN/TURN cho Person 1.

=========================================================